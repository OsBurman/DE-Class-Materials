package com.security;

import org.mindrot.jbcrypt.BCrypt;

/**
 * Exercise 01 – Secure implementations to replace VulnerableUserService.
 *
 * TODO: Implement each method securely.
 *       Read the Javadoc comment on each method before writing code.
 */
public class SecureUserService {

    /**
     * Simulate fetching a user by id using a SAFE parameterised query.
     *
     * In real code you would use PreparedStatement:
     *   PreparedStatement ps = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
     *   ps.setString(1, id);
     *
     * For this exercise: validate that id contains only digits; if not, throw
     * IllegalArgumentException("Invalid id"). Otherwise return "User{id=<id>, name='Alice'}".
     *
     * TODO: Validate id, throw IllegalArgumentException if it contains non-digit characters,
     *       otherwise return the formatted user string.
     */
    public String getUserById(String id) {
        // TODO: Use id.matches("\\d+") to check for digits only
        // TODO: Throw new IllegalArgumentException("Invalid id") if check fails
        // TODO: Return "User{id=" + id + ", name='Alice'}"
        return null;
    }

    /**
     * Secure login: compare a plaintext input password against a BCrypt hash.
     *
     * TODO: Use BCrypt.checkpw(inputPassword, storedHash) and return its result.
     *       storedHash is already a BCrypt hash (generated with BCrypt.hashpw()).
     */
    public boolean login(String inputPassword, String storedHash) {
        // TODO: return BCrypt.checkpw(inputPassword, storedHash);
        return false;
    }

    /**
     * Return a masked representation of a sensitive config value.
     *
     * If key equals "db.password" return "db.password = [REDACTED]".
     * For any other key return "unknown".
     *
     * TODO: Never return the actual secret value.
     */
    public String getConfigValue(String key) {
        // TODO: check if key is "db.password" and return the masked string
        return null;
    }

    /**
     * Log user actions safely by stripping newline characters.
     *
     * TODO: Replace all occurrences of '\n' and '\r' in userInput with a space,
     *       then print "INFO: User performed action: " + sanitised input.
     */
    public void logUserAction(String userInput) {
        // TODO: String safe = userInput.replaceAll("[\r\n]", " ");
        // TODO: System.out.println("INFO: User performed action: " + safe);
    }

    public static void main(String[] args) {
        SecureUserService svc = new SecureUserService();

        System.out.println("=== Secure Implementations ===");

        System.out.println("getUserById(1)       → " + svc.getUserById("1"));

        String hash = BCrypt.hashpw("secret", BCrypt.gensalt());
        System.out.println("login(valid)         → " + svc.login("secret", hash));
        System.out.println("login(invalid)       → " + svc.login("wrong", hash));

        System.out.println("getConfigValue(key)  → " + svc.getConfigValue("db.password"));

        svc.logUserAction("login\nINFO: Admin logged in");
    }
}
